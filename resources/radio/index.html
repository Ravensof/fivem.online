<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.0.15/howler.core.min.js"></script>
	<script>
		let MODULE_FOLDER_NAME = "fivem-online";

		let Nui = {
			/**
			 * @param eventName {string}
			 * @param data
			 * @param callback
			 */
			emit: function (eventName, data = null, callback = function (result) {
			}) {
				fetch(
					"http://" + MODULE_FOLDER_NAME + "/" + eventName,
					{"method": "POST", "body": JSON.stringify(data)}
				)
					.then(function (response) {
						return response.text()
					})
					.then(function (body) {
						callback(body)
					})

			},
			// on: function(eventName, callback=function(event){}){
			// 	window.addEventListener("message", (event) => {
			//
			// 		let data = event.data;
			// 	})
			// }
		};

		let sound;

		document.addEventListener("DOMContentLoaded", () => {

			Nui.emit("radio:ready");

			window.addEventListener("message", (event) => {

				let data = event.data;

				switch (data.type) {
					case "play":
						if (sound != null) {
							sound.stop();
						}

						sound = new Howl({
							src: data.url,
							html5: true, // A live stream can only be played through HTML5 Audio.
							format: ['opus', 'ogg', 'mp3'],
							volume: data.volume
						});

						sound.play();

						break;
					case "stop":
						if (sound != null) {
							sound.stop();
						}
						break;
					case "volume":
						if (sound != null) {
							sound.volume(data.volume);
						}
						break;
				}
			});
		});
	</script>
</head>
<body>
</body>
</html>